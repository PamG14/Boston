// Function to verify certificate ID
function verifyCertificate(event) {
    event.preventDefault();  // Prevent the default form submission

    const certificateId = document.getElementById('certificate-id').value.trim();
    if (!certificateId) {
        alert('Please enter a certificate ID');
        return;
    }

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`); // Handle non-OK responses
            }
            return response.json();
        })
        .then(data => {
            console.log(data);  // Log the response to see what it contains

            // Check for errors in the response
            if (data.error) {
                console.error('API Error:', data.error);
                document.getElementById('verification-result').innerHTML = `
                    <h3>Error verifying certificate</h3>
                    <p>${data.error.message}</p>
                `;
                return;
            }

            if (data.values && Array.isArray(data.values)) {
                const rows = data.values;
                let certificateFound = false;

                // Loop through the rows to find the certificate ID
                rows.forEach(row => {
                    if (row[0] === certificateId) {  // Assuming ID is in the first column
                        certificateFound = true;
                        document.getElementById('verification-result').innerHTML = `
                            <h3>Certificate Verified!</h3>
                            <p>Certificate ID: ${row[0]}</p>
                            <p>Student: ${row[1]}</p>
                            <p>Course: ${row[2]}</p>
                            <p>Date: ${row[3]}</p>
                        `;
                    }
                });

                // If the certificate was not found
                if (!certificateFound) {
                    document.getElementById('verification-result').innerHTML = `
                        <h3>Certificate not found</h3>
                        <p>The certificate ID entered does not exist in our records.</p>
                    `;
                }
            } else {
                console.error('No valid data found:', data);
                document.getElementById('verification-result').innerHTML = `
                    <h3>Error verifying certificate</h3>
                    <p>No data available for verification.</p>
                `;
            }
        })
        .catch(error => {
            console.error('Error fetching data:', error);  // Log the error for debugging
            document.getElementById('verification-result').innerHTML = `
                <h3>Error verifying certificate</h3>
                <p>There was an error verifying the certificate. Please try again later.</p>
                <p><strong>Error Details:</strong> ${error.message}</p>  <!-- Display error details to the user -->
            `;
        });
}
